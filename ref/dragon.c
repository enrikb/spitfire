#include <stdio.h>
#include <string.h>

#include "ecrypt-sync.h"

static const unsigned nblocks = 16;

static const u8 key[] =
{
  0x00, 0x00, 0x11, 0x11, 0x22, 0x22, 0x33, 0x33, 0x44, 0x44, 0x55, 0x55, 0x66, 0x66, 0x77, 0x77,
  0x88, 0x88, 0x99, 0x99, 0xaa, 0xaa, 0xbb, 0xbb, 0xcc, 0xcc, 0xdd, 0xdd, 0xee, 0xee, 0xff, 0xff
};

static const u8 iv[] =
{
  0x00, 0x00, 0x11, 0x11, 0x22, 0x22, 0x33, 0x33, 0x44, 0x44, 0x55, 0x55, 0x66, 0x66, 0x77, 0x77,
  0x88, 0x88, 0x99, 0x99, 0xaa, 0xaa, 0xbb, 0xbb, 0xcc, 0xcc, 0xdd, 0xdd, 0xee, 0xee, 0xff, 0xff
};

int main(void)
{
    ECRYPT_init();

    ECRYPT_ctx ctx;
    memset(&ctx, 0, sizeof(ctx));

    ECRYPT_keysetup(&ctx, key, 256, 256);
    ECRYPT_ivsetup(&ctx, iv);

    // dragon produces 64bit key stream blocks
    u8 keyblocks[nblocks*2*4];
    ECRYPT_keystream_blocks(&ctx, keyblocks, nblocks);

    // output 32bit groups
    for (size_t i = 0; i < nblocks*2; i++) {
      for (size_t j = 0; j < 4; j++) {
        printf("%02x", keyblocks[4*i + j]);
      }
      fputc(i%8==7? '\n':' ', stdout);
    }

    return 0;
}
