// Copyright Â© Helmut Schellong, 2022

#if !defined(BSH_H)
#                include <stdio.h>
#                include <string.h>
#                include <stdint.h>
#                include <stdlib.h>
#                include <unistd.h>
#                include <fcntl.h>
# define noret  _Noreturn
# define byte  char
#endif
#if !defined(O_BINARY)
# define O_BINARY  0
#endif



static void noret dragE(const char *es, int e)
{
   fprintf(stderr, "dragon: %s\n", es);
#  if defined(BSH_H)
   Exit=2;
   bsh_Err(LS16|E_NOTHG, 0);
   ErrXI(1);
#  else
   exit(e);
#  endif
}

#if !defined(DRAGON_TEST)
# define DRAGON_TEST  0
#endif

# define UPDATE_F()  \
      b^=a, d^=c, f^=e, c+=b, e+=d, a+=f; \
      d^= S1[a>>24&255] ^ S1[a>>16&255] ^ S1[a>>8&255] ^ S2[a&255]; \
      f^= S1[c>>24&255] ^ S1[c>>16&255] ^ S2[c>>8&255] ^ S1[c&255]; \
      b^= S1[e>>24&255] ^ S2[e>>16&255] ^ S1[e>>8&255] ^ S1[e&255]; \
      a^= S2[b>>24&255] ^ S2[b>>16&255] ^ S2[b>>8&255] ^ S1[b&255]; \
      c^= S2[d>>24&255] ^ S2[d>>16&255] ^ S1[d>>8&255] ^ S2[d&255]; \
      e^= S2[f>>24&255] ^ S1[f>>16&255] ^ S2[f>>8&255] ^ S2[f&255]; \
      d+=a, f+=c, b+=e; c^=b, e^=d, a^=f; \
      d= d<<16|d>>16, f= f<<16|f>>16, b= b<<16|b>>16; \
      c= c<<16|c>>16, e= e<<16|e>>16, a= a<<16|a>>16;

static uint32_t const S1[], S2[];


static int dragon(int C, char *A[])
{
   static char args[]= "dragon  key init  in out\n"
                       "(key,init: 64 hex-digits (256 Bit), in-file, out-file)";
   static _Bool pass;
   uint64_t W[8][2], M, K[4], I[4], q, sum=0;
   uint32_t B[32], a, b, c, d, e, f;
   unsigned i, p;
   int fd[2];
#  if !defined(BSH_H)
   static char Chex[256];
   static char Chex0[]= "0123456789ABCDEFabcdef";
   for (i=0;  i<sizeof(Chex0)-1;  ++i)  { int c= Chex0[i];
      Chex[c]= (c>='a'?c-'a'+10:(c>='A'?c-'A'+10:c-'0'))+1;
   }
#  endif
   if (C==2)  {
     pass= A[1][0]=='X'&&A[1][1]=='x'&&A[1][2]=='x'&&A[1][3]=='X'&&
           A[1][4]=='x'&&A[1][5]=='x'&&A[1][6]=='x'&&A[1][7]==0 ? 1 : 0;
     return 0;
   }
   if (!pass&&DRAGON_TEST==0)  return 0;
   if (C!=5)  dragE(args, 1);
   for (i=0;  i<4;  ++i)  K[i]=I[i]= 0;
   for (p=1;  p<3;  ++p)  { char *ap, h; unsigned m; uint64_t *P; unsigned nb;
      ap= A[p]; P= p==1 ?  K : I;
      for (h=1,i=0;  i<256+1&&ap[i];  ++i)  if (!Chex[ap[i]])  h=0;
      switch (i)  {
        default :  dragE(args, 2); break;
        case 256:  for (i=0;  i<256;  ++i)  P[i/64]<<=1, P[i/64]|= ap[i]&1;
                   break;
        case  64:  if (!h)  dragE(args, 2);
                   for (nb=i=0;  i<64;  nb+=i&1,++i)  {
                      h= Chex[ap[i]]-1;
                      if (!(i&1))  m =h, m<<=4;
                      else         m|=h, P[nb/8]|= (uint64_t)m<<8*((31-nb)%8);
                   }
                   break;
        case  32:  for (i=0;  i<32;  ++i)  P[i/8]|= ap[i]<<8*(i%8);
                   break;
      }
   }
   if (DRAGON_TEST<=0)  {
     fd[0]= open(A[3], O_RDONLY|O_BINARY);
     if (fd[0]<0)  dragE("Oeffnen in-file" , 4);
     fd[1]= open(A[4], O_WRONLY|O_BINARY|O_CREAT|O_TRUNC|O_SYNC, 0644);
     if (fd[1]<0)  dragE("Oeffnen out-file", 5);
   }
   W[0][0]= K[0], W[0][1]= K[1];
   W[1][0]= K[2], W[1][1]= K[3];
   W[2][0]=   K[0]^I[0],  W[2][1]=   K[1]^I[1];
   W[3][0]=   K[2]^I[2],  W[3][1]=   K[3]^I[3];
   W[4][0]= ~(K[0]^I[0]), W[4][1]= ~(K[1]^I[1]);
   W[5][0]= ~(K[2]^I[2]), W[5][1]= ~(K[3]^I[3]);
   W[6][0]= I[0], W[6][1]= I[1];
   W[7][0]= I[2], W[7][1]= I[3];
   M= 0x447261676F6Eull;
   for (i=0;  i<16;  ++i)  {
      q= W[0][0]^W[6][0]^W[7][0]; c= q>>32, d= q;
      q= W[0][1]^W[6][1]^W[7][1]; a= q>>32, b= q;
      e= M>>32, f= M;
      UPDATE_F();
      W[0][0]= ((uint64_t)c<<32|d) ^ W[4][0];
      W[0][1]= ((uint64_t)a<<32|b) ^ W[4][1];
      for (q=7;  q>0;  --q)  W[q][0]= W[q-1][0], W[q][1]= W[q-1][1];
      M= (uint64_t)e<<32 | f;
   }
   for (i=0;  i<32;  i+=2)  q= ((uint64_t*)W)[i/2], B[i]= q, B[i+1]= q>>32;
   int nb=0, nk=0, wr=16;
   while (1)  { uint64_t k, buf[2*1024];
      a= B[0]; b= B[9]; c= B[16]; d= B[19]; e= B[30]^M>>32; f= B[31]^M;
      UPDATE_F();
      B[0]= b; B[1]= c;
      for (i=31;  i>1;  --i)  B[i]= B[i-2];
      M+= 1;
      k= (uint64_t)a<<32 | e;
      if (DRAGON_TEST>0)  {
        if (wr-->0)  {
          for (i=0; i<8; ++i)  printf("%02hhX", (byte)(k>>8*i));
          printf(wr%4==0?"\n":" ");  continue;
        }
        else  return 0;
      }
      if (nb<=0)  {
        nb= read(fd[0], buf, sizeof(buf));
        if (nb< 0)  dragE("Lesen des in-file", 6);
        if (nb<=0)  break;
      }
      if (nb>0)  {
        buf[nk++]^= k, nb-=sizeof(k);
        if (nb<=0)  { int nw;
          nw= write(fd[1], buf, (wr= nk*sizeof(k)+nb, wr));
          if (nw!=wr)  dragE("Schreiben des out-file", 7);
          if (nk=0,sum+=nw, nb<0)  break;
        }
      }
   }
   close(fd[0]);
   close(fd[1]);
   printf("dragon: %lld Bytes\n", (long long)sum);
   return 0;
}



static uint32_t const S1[256]= {
0x393BCE6B,0x232BA00D,0x84E18ADA,0x84557BA7,0x56828948,0x166908F3,
0x414A3437,0x7BB44897,0x2315BE89,0x7A01F224,0x7056AA5D,0x121A3917,
0xE3F47FA2,0x1F99D0AD,0x9BAD518B,0x99B9E75F,0x8829A7ED,0x2C511CA9,
0x1D89BF75,0xF2F8CDD0,0x2DA2C498,0x48314C42,0x922D9AF6,0xAA6CE00C,
0xAC66E078,0x7D4CB0C0,0x5500C6E8,0x23E4576B,0x6B365D40,0xEE171139,
0x336BE860,0x5DBEEEFE,0x0E945776,0xD4D52CC4,0x0E9BB490,0x376EB6FD,
0x6D891655,0xD4078FEE,0xE07401E7,0xA1E4350C,0xABC78246,0x73409C02,
0x24704A1F,0x478ABB2C,0xA0849634,0x9E9E5FEB,0x77363D8D,0xD350BC21,
0x876E1BB5,0xC8F55C9D,0xD112F39F,0xDF1A0245,0x9711B3F0,0xA3534F64,
0x42FB629E,0x15EAD26A,0xD1CFA296,0x7B445FEE,0x88C28D4A,0xCA6A8992,
0xB40726AB,0x508C65BC,0xBE87B3B9,0x4A894942,0x9AEECC5B,0x6CA6F10B,
0x303F8934,0xD7A8693A,0x7C8A16E4,0xB8CF0AC9,0xAD14B784,0x819FF9F0,
0xF20DCDFA,0xB7CB7159,0x58F3199F,0x9855E43B,0x1DF6C2D6,0x46114185,
0xE46F5D0F,0xAAC70B5B,0x48590537,0x0FD77B28,0x67D16C70,0x75AE53F4,
0xF7BFECA1,0x6017B2D2,0xD8A0FA28,0xB8FC2E0D,0x80168E15,0x0D7DEC9D,
0xC5581F55,0xBE4A2783,0xD27012FE,0x53EA81CA,0xEBAA07D2,0x54F5D41D,
0xABB26FA6,0x41B9EAD9,0xA48174C7,0x1F3026F0,0xEFBADD8E,0x387E9014,
0x1505AB79,0xEADF0DF7,0x67755401,0xDA2EF962,0x41670B0E,0x0E8642F2,
0xCE486070,0xA47D3312,0x4D7343A7,0xECDA58D0,0x1F79D536,0xD362576B,
0x9D3A6023,0xC795A610,0xAE4DF639,0x60C0B14E,0xC6DD8E02,0xBDE93F4E,
0xB7C3B0FF,0x2BE6BCAD,0xE4B3FDFD,0x79897325,0x3038798B,0x08AE6353,
0x7D1D20EB,0x3B208D21,0xD0D6D104,0xC5244327,0x9893F59F,0xE976832A,
0xB1EB320B,0xA409D915,0x7EC6B543,0x66E54F98,0x5FF805DC,0x599B223F,
0xAD78B682,0x2CF5C6E8,0x4FC71D63,0x08F8FED1,0x81C3C49A,0xE4D0A778,
0xB5D369CC,0x2DA336BE,0x76BC87CB,0x957A1878,0xFA136FBA,0x8F3C0E7B,
0x7A1FF157,0x598324AE,0xFFBAAC22,0xD67DE9E6,0x3EB52897,0x4E07E855,
0x87CE73F5,0x8D046706,0xD42D18F2,0xE71B1727,0x38473B38,0xB37B24D5,
0x381C6AE1,0xE77D6589,0x6018CBFF,0x93CF3752,0x9B6EA235,0x504A50E8,
0x464EA180,0x86AFBE5E,0xCC2D6AB0,0xAB91707B,0x1DB4D579,0xF9FAFD24,
0x2B28CC54,0xCDCFD6B3,0x68A30978,0x43A6DFD7,0xC81DD98E,0xA6C2FD31,
0x0FD07543,0xAFB400CC,0x5AF11A03,0x2647A909,0x24791387,0x5CFB4802,
0x88CE4D29,0x353F5F5E,0x7038F851,0xF1F1C0AF,0x78EC6335,0xF2201AD1,
0xDF403561,0x4462DFC7,0xE22C5044,0x9C829EA3,0x43FD6EAE,0x7A42B3A7,
0x5BFAAAEC,0x3E046853,0x5789D266,0xE1219370,0xB2C420F8,0x3218BD4E,
0x84590D94,0xD51D3A8C,0xA3AB3D24,0x2A339E3D,0xFEE67A23,0xAF844391,
0x17465609,0xA99AD0A1,0x05CA597B,0x6024A656,0x0BF05203,0x8F559DDC,
0x894A1911,0x909F21B4,0x6A7B63CE,0xE28DD7E7,0x4178AA3D,0x4346A7AA,
0xA1845E4C,0x166735F4,0x639CA159,0x58940419,0x4E4F177A,0xD17959B2,
0x12AA6FFD,0x1D39A8BE,0x7667F5AC,0xED0CE165,0xF1658FD8,0x28B04E02,
0x1FA480CF,0xD3FB6FEF,0xED336CCB,0x9EE3CA39,0x9F224202,0x2D12D6E8,
0xFAAC50CE,0xFA1E98AE,0x61498532,0x03678CC0,0x9E85EFD7,0x3069CE1A,
0xF115D008,0x4553AA9F,0x3194BE09,0xB4A9367D,0x0A9DFEEC,0x7CA002D6,
0x8E53A875,0x965E8183,0x14D79DAC,0x0192B555 };

static uint32_t const S2[256]= {
0xA94BC384,0xF7A81CAE,0xAB84ECD4,0x00DEF340,0x8E2329B8,0x23AF3A22,
0x23C241FA,0xAED8729E,0x2E59357F,0xC3ED78AB,0x687724BB,0x7663886F,
0x1669AA35,0x5966EAC1,0xD574C543,0xDBC3F2FF,0x4DD44303,0xCD4F8D01,
0x0CBF1D6F,0xA8169D59,0x87841E00,0x3C515AD4,0x708784D6,0x13EB675F,
0x57592B96,0x07836744,0x3E721D90,0x26DAA84F,0x253A4E4D,0xE4FA37D5,
0x9C0830E4,0xD7F20466,0xD41745BD,0x1275129B,0x33D0F724,0xE234C68A,
0x4CA1F260,0x2BB0B2B6,0xBD543A87,0x4ABD3789,0x87A84A81,0x948104EB,
0xA9AAC3EA,0xBAC5B4FE,0xD4479EB6,0xC4108568,0xE144693B,0x5760C117,
0x48A9A1A6,0xA987B887,0xDF7C74E0,0xBC0682D7,0xEDB7705D,0x57BFFEAA,
0x8A0BD4F1,0x1A98D448,0xEA4615C9,0x99E0CBD6,0x780E39A3,0xADBCD406,
0x84DA1362,0x7A0E984B,0xBED853E6,0xD05D610B,0x9CAC6A28,0x1682ACDF,
0x889F605F,0x9EE2FEBA,0xDB556C92,0x86818021,0x3CC5BEA1,0x75A934C6,
0x95574478,0x31A92B9B,0xBFE3E92B,0xB28067AE,0xD862D848,0x0732A22D,
0x840EF879,0x79FFA920,0x0124C8BB,0x26C75B69,0xC3DAAAC5,0x6E71F2E9,
0x9FD4AFA6,0x474D0702,0x8B6AD73E,0xF5714E20,0xE608A352,0x2BF644F8,
0x4DF9A8BC,0xB71EAD7E,0x6335F5FB,0x0A271CE3,0xD2B552BB,0x3834A0C3,
0x341C5908,0x0674A87B,0x8C87C0F1,0xFF0842FC,0x48C46BDB,0x30826DF8,
0x8B82CE8E,0x0235C905,0xDE4844C3,0x296DF078,0xEFAA6FEA,0x6CB98D67,
0x6E959632,0xD5D3732F,0x68D95F19,0x43FC0148,0xF808C7B1,0xD45DBD5D,
0x5DD1B83B,0x8BA824FD,0xC0449E98,0xB743CC56,0x41FADDAC,0x141E9B1C,
0x8B937233,0x9B59DCA7,0xF1C871AD,0x6C678B4D,0x46617752,0xAAE49354,
0xCABE8156,0x6D0AC54C,0x680CA74C,0x5CD82B3F,0xA1C72A59,0x336EFB54,
0xD3B1A748,0xF4EB40D5,0x0ADB36CF,0x59FA1CE0,0x2C694FF9,0x5CE2F81A,
0x469B9E34,0xCE74A493,0x08B55111,0xEDED517C,0x1695D6FE,0xE37C7EC7,
0x57827B93,0x0E02A748,0x6E4A9C0F,0x4D840764,0x9DFFC45C,0x891D29D7,
0xF9AD0D52,0x3F663F69,0xD00A91B9,0x615E2398,0xEDBBC423,0x09397968,
0xE42D6B68,0x24C7EFB1,0x384D472C,0x3F0CE39F,0xD02E9787,0xC326F415,
0x9E135320,0x150CB9E2,0xED94AFC7,0x236EAB0F,0x596807A0,0x0BD61C36,
0xA29E8F57,0x0D8099A5,0x520200EA,0xD11FF96C,0x5FF47467,0x575C0B39,
0x0FC89690,0xB1FBACE8,0x7A957D16,0xB54D9F76,0x21DC77FB,0x6DE85CF5,
0xBFE7AEE9,0xC49571A9,0x7F1DE4DA,0x29E03484,0x786BA455,0xC26E2109,
0x4A0215F4,0x44BFF99C,0x711A2414,0xFDE9CDD0,0xDCE15B77,0x66D37887,
0xF006CB92,0x27429119,0xF37B9784,0x9BE182D9,0xF21B8C34,0x732CAD2D,
0xAF8A6A60,0x33A5D3AF,0x633E2688,0x5EAB5FD1,0x23E6017A,0xAC27A7CF,
0xF0FC5A0E,0xCC857A5D,0x20FB7B56,0x3241F4CD,0xE132B8F7,0x4BB37056,
0xDA1D5F94,0x76E08321,0xE1936A9C,0x876C99C3,0x2B8A5877,0xEB6E3836,
0x9ED8A201,0xB49B5122,0xB1199638,0xA0A4AF2B,0x15F50A42,0x775F3759,
0x41291099,0xB6131D94,0x9A563075,0x224D1EB1,0x12BB0FA2,0xFF9BFC8C,
0x58237F23,0x98EF2A15,0xD6BCCF8A,0xB340DC66,0x0D7743F0,0x13372812,
0x6279F82B,0x4E45E519,0x98B4BE06,0x71375BAE,0x2173ED47,0x14148267,
0xB7AB85B5,0xA875E314,0x1372F18D,0xFD105270,0xB83F161F,0x5C175260,
0x44FFD49F,0xD428C4F6,0x2C2002FC,0xF2797BAF,0xA3B20A4E,0xB9BF1A89,
0xE4ABA5E2,0xC912C58D,0x96516F9A,0x51561E77 };


#undef UPDATE_F



    /*d_= d+a, f_= f+c, b_= b+e; \
      c_= c^b, e_= e^d, a_= a^f; \
      d_= d_<<16|d_>>16, f_= f_<<16|f_>>16, b_= b_<<16|b_>>16; \
      c_= c_<<16|c_>>16, e_= e_<<16|e_>>16, a_= a_<<16|a_>>16;*/

#if 0
KEY:
00001111 22223333 44445555 66667777 88889999 AAAABBBB CCCCDDDD EEEEFFFF
IV:
00001111 22223333 44445555 66667777 88889999 AAAABBBB CCCCDDDD EEEEFFFF
KEYSTREAM:
BC020767 DC48DAE3 14778D8C 927E8B32 E086C6CD E593C008 600C9D47 A488F622
3A2B94D6 B853D644 27E93362 ABB8BA21 751CAAF7 BD316595 2A37FC1E A3F12FE2
5C133BA7 4C15CE4B 3542FDF8 93DAA751 F5710256 49795D54 31914EBA 0DE2C2A7
8013D29B 56D4A028 3EB6F312 7644ECFE 38B9CA11 1924FBC9 4A0A30F2 AFFF5FE0
KEY:
00112233 44556677 8899AABB CCDDEEFF 00112233 44556677 8899AABB CCDDEEFF
IV:
00112233 44556677 8899AABB CCDDEEFF 00112233 44556677 8899AABB CCDDEEFF
KEYSTREAM:
8D3AB9BA 01DAA3EB 5CBD0F6D E3ECFCAB 619AF808 CF9C4A42 E2877766 6D2D7037
EE6F94AC 29D1EEE5 340DB047 8E91A679 480D8D88 2367CE2A 31C96AD4 49E70756
815EBEB2 290DBA7A 3CCB76A2 257BD122 2B0B7AED 917FAFFF 6B58B2B2 B05F24F6
E271A016 9E897BEF F5C22451 DA6F9E40 52B78BE5 6C97C1A5 C6F8E791 0F7B9C98

Clang -DDRAGON_TEST=1 dragon.c
4CFE5965F3BBA18D E0F4ED0D8FFF5628 DB26CC41547CC029 B0CF4E3F45C3156B
4AB9F5725F199EE8 33C2CB581064AA95 CB8AF2C69C773FCC AA7EA36F6459E095
2065A7DC877ECAA4 E82C29893F6B39DB FB3B3C87789BDB0A 08FAF86690C3210A
81015B94FAB69FC1 B057E31F840AA47F BA9E21AD117E10EA 0E30EC4B4A6FE74C

27994633578AFB7B CD558FE7C0E92587 0D19EEC5D00F7C83 052B68A48ED1A887
0C42BA7B296FCB64 F8BB74E986E1CABE 859C78AA52928147 9E328AA459D157A3
B94A780C9837637E CA85BBABF6096EB1 796B9E7C36F2384A 8E4C53FB894190F2
45B895512C58B53E 7DE0D45F81E63593 C6D341C457242456 0B70BD733287EBF3

23FFAF6298AB65E9 DA652EFEF076D86E F0E7E053D741C474 0D3DFC1F5A440458
31B8DE9EB0FACB1B B8F11C046F389CD2 838199970D58D0E6 4B273C7E5B245B9E
93224038B89CF1C4 DF91D37505A45FD2 0FFEC95F99DE7676 5CDCA410D69456AC
72ACC44A2A2AEEDB 83FCE52E3DB651EB 905243F413185648 A0FFA600CC275230

3961F5BC8712605E 8966F46684D50B7B D0062949CC2F01B8 AB6FA4DCB65FDE53
F9D45445AA281A94 58A91739D17679D2 FA93565C1CA3BE17 94DA5E3258D68F14
964802B181A159E3 00E142B674DA23C5 8CC496C21BD33440 4804189ADDA58FF8
70C153E1E807B56B 1F60771EE0C30EC6 9244580A842CAC38 DE04CE083E5507C7

9BF715A203625CFF 3A07D2E7A6CC6DC7 7202E4ACBC6FBA99 2B15548940215C8A
3A8F2D8439471B9A 6785E04F3302BDEE 845D2A5DF9C9D496 CC0C0BFB9CCAAA39
843BECF642B4C1B1 A46391957523CD3F 1D0AAEA7A5EB1BA6 F39F9761E410ECB6
6A4516C01D01D3F2 3CD05B3733DFC4B9 C587694D9E3AB083 6B9083329C0B42FF

64EDDB9973AFC45E 3E76FBDA76A55491 E8787E3311D92910 EAC3632FE9C83A42
388B6970E1AE5FF9 0A707ABC1B67BC8B 5B2F44E64BD149DF FF6B3EEFA32AB464
15F1F3D1E0BEEBD3 C0EE49A52F28D3B4 18DBD45E23404EBA 69F7A09A77B44ABE
36E463D60460E4BB 3294CCB2A117D2AB 89BEF7F84791668C 649C7573660E890F

E0FFBB194D142B01 87C370F3D88A2011 C8BBDA796004C356 5CE6F82BF7477F87
6D8ADD8C4C675A1D BCC28F4AAD435C4A 76B094C9FAAF9158 B7F2733514DBEDEF
23B0F6B1F68E7087 9125B7B015CFC78D 84137932FFB8FE3A 76C5FC61DFAE3D28
E45F58AEED52AFF5 225FC137AF9440C8 AFA9D09E24BB9660 35BDD3877E28B0E9

811A904CB5B774B3 F13DEF23F0D1DCAF E1ADADD23DCCC995 543A382FE90BF88F
25F1100A1A8CD7DE C1F732049415F774 1D542C0AE54E74BC C108018CA621EE3F
EB6D53ED4ABEFD5C EDF094A3D527E21D 8489C3FC099F5137 100807CBB2678DB5
3E1574ABEC06998B 8983A4588844C9E9 EFC8875B41767266 3CF43AF526F51D08

E0FFBB194D142B01 87C370F3D88A2011 C8BBDA796004C356 5CE6F82BF7477F87
6D8ADD8C4C675A1D BCC28F4AAD435C4A 76B094C9FAAF9158 B7F2733514DBEDEF
23B0F6B1F68E7087 9125B7B015CFC78D 84137932FFB8FE3A 76C5FC61DFAE3D28
E45F58AEED52AFF5 225FC137AF9440C8 AFA9D09E24BB9660 35BDD3877E28B0E9

FA0046B23433191C 73541959811E00CB FB9343569BCB8CC8 7B193A40E701C6AB
0132FCC49224436D 16221C12437C2E46 54D9256368C8CA82 68418D4745427716
1AA35A67A917AEFB F7FB5EEA0C70B0F3 68E03F9061C901EA A707AC9FD04CB0B2
BE54E06C0248594D 331A30368C6ECB1C 93C7D23F7DDF59CE 4E6A46390907A8E5

B822A6F6E35DAD57 E474C864D0ABDFB3 0C3BEF1057B33D73 A7E2AEECA191F5B4
6A9A89EA81A3162A A8632882CFD8DEC9 CC7AC58DCE98CA58 0A746ED185401AB6
FF21E89E48EA03E1 D268A2EC70412B41 D9E3CF258583BCE7 F4FE4CC7102424A7
A6D730680A4F975F D3A17E6F949C4A8F 85F57E3E719B4869 0369E6C30C4D81CE

69BCF53CE55EDF27 F59BFCB70BFA61EA 329E09DB0231F10E 3CDEAFF24B50B5F8
3192433110151DA9 F46D01D4D200D97C 944CE8BC93FFA561 02CC02CB6420EF63
D20A1057C746C9C1 4CB94DB578114292 8A45E0FC219B2092 5931B2318A6126F9
9DB9AADBD4BC709C 6810110A89046B22 3EEE51949E9D9256 9041C1185C3A13BE

AA17D3DB65145D64 82B0E8A285715DBF 2A171FF8A33240F2 EE353AC6AB14B62F
7676FBC1DFAE3D64 27ACD79B74A82C70 13F153C8C1268DF1 08F2AA2D56F377CF
258857D1CE48301D 6510FDE0A2921559 23A569A23B45BE58 67787A82000F2832
8DFF410BAA74DA2C 68507B55AECF70E4 BAD93C3BA541F8B3 E5FCFC4C0DB79D90

FA12B18501A8CCF4 B07818C0AAB3ABC8 CF1B2465AEEB8741 1BB9B3EA18686A11
6EE43A792E043092 E6AACA4C1178B29B 6B55A151FB572995 8DE7B25BFD33789A
AB90DBDEC5A84A1B 71AD00540E4BE018 AB4C1090976E226B 3DCE08B5CCB09B23
78872D3DE5BEA487 3EF0A8CDE8CDCEC9 0AE5A8B8A82E5682 10C447B425B6AFB3
key=iv=0:
182A9F769D91717A 5BAC8E294505283D 59DA9124EE02B7BD 94927BB79F7FBAD0
D1BD645ED9DD297C E1CF855D47DC337F 29913CEA7242F638 0974ECB01A15DD39
7ED135A3982A7D71 95931E7F1D4DED8F BBA8537452EA536D E0B824AB1A1C990C
CC2C52D990EDE135 78A58F958A1EEB34 DC70BB2E26FC737C CDE39B67D95E4907
#endif



#if !defined(BSH_H)

int main(int ac, char *av[])
{
   static char *argv[]= { "dragon",
      "0000111122223333444455556666777788889999AAAABBBBCCCCDDDDEEEEFFFF",
      "0000111122223333444455556666777788889999AAAABBBBCCCCDDDDEEEEFFFF",
      0, 0,
      "00112233445566778899AABBCCDDEEFF00112233445566778899AABBCCDDEEFF",
      "00112233445566778899AABBCCDDEEFF00112233445566778899AABBCCDDEEFF",
      "0000000000000000000000000000000000000000000000000000000000000000",
      "0000000000000000000000000000000000000000000000000000000000000000",
      0
   };
   static char *avp[]= { "dragon", "XxxXxxx", 0 };

   if (DRAGON_TEST==0)  {
     if (ac!=3)  return 1;
     argv[3]= av[1], argv[4]= av[2];
     dragon(2, avp);
   }
   return dragon(5, argv);
}

#endif
